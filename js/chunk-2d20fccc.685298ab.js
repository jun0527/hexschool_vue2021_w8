(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d20fccc"],{b4bf:function(t,e,a){"use strict";a.r(e);var o=a("7a23"),n={class:"py-4"},c=Object(o["h"])("h2",{class:"text-center"},"優惠券管理",-1),l={class:"d-flex justify-content-end"},d={class:"table table-hover"},i=Object(o["h"])("thead",null,[Object(o["h"])("tr",null,[Object(o["h"])("th",{width:"25%"},"優惠券名稱"),Object(o["h"])("th",{width:"10%"},"優惠內容"),Object(o["h"])("th",{width:"15%"},"優惠券到期日"),Object(o["h"])("th",{width:"15%"},"是否啟用"),Object(o["h"])("th",{width:"25%"},"操作")])],-1),s={key:0,class:"loading"},u=Object(o["h"])("div",{class:"icon"},null,-1);function r(t,e,a,r,b,p){var h=Object(o["y"])("pagination"),m=Object(o["y"])("CouponModal"),j=Object(o["y"])("DeleteModal");return Object(o["t"])(),Object(o["d"])(o["a"],null,[Object(o["h"])("div",n,[c,Object(o["h"])("div",l,[Object(o["h"])("button",{type:"button",class:"btn btn-primary mb-3",onClick:e[1]||(e[1]=function(t){return p.openModal("addCoupon")})},"建立優惠券")]),Object(o["h"])("table",d,[i,Object(o["h"])("tbody",null,[(Object(o["t"])(!0),Object(o["d"])(o["a"],null,Object(o["x"])(b.coupons,(function(t){return Object(o["t"])(),Object(o["d"])("tr",{class:"align-middle",key:t.id},[Object(o["h"])("td",null,Object(o["B"])(t.title),1),Object(o["h"])("td",null,Object(o["B"])(t.percent)+"%",1),Object(o["h"])("td",null,Object(o["B"])(t.due_date_string),1),Object(o["h"])("td",null,[Object(o["h"])("input",{type:"checkbox",class:"checkbox",id:t.id,onChange:function(e){return p.changeStatus(t.is_enabled,t)},checked:1===t.is_enabled},null,40,["id","onChange","checked"]),Object(o["h"])("label",{for:t.id,class:"checkbox"},Object(o["B"])(1===t.is_enabled?"啟用":"不啟用"),9,["for"])]),Object(o["h"])("td",null,[Object(o["h"])("button",{type:"button",class:"btn btn-primary me-2",onClick:function(e){return p.openModal("editCoupon",t)}},"編輯",8,["onClick"]),Object(o["h"])("button",{type:"button",class:"btn btn-outline-danger",onClick:function(e){return p.openModal("deleteCoupon",t)}}," 刪除",8,["onClick"])])])})),128))])]),Object(o["h"])(h,{paginationData:b.pagination,onGetData:p.getCouponData},null,8,["paginationData","onGetData"])]),b.getCouponLoading?(Object(o["t"])(),Object(o["d"])("div",s,[u])):Object(o["e"])("",!0),Object(o["h"])(m,{ref:"couponModal",onGetCouponsData:p.getCouponData},null,8,["onGetCouponsData"]),Object(o["h"])(j,{ref:"deleteModal",onGetCouponsData:p.getCouponData},null,8,["onGetCouponsData"])],64)}var b=a("5530"),p=(a("99af"),{ref:"modal",class:"modal fade",tabindex:"-1"}),h={class:"modal-dialog"},m={class:"modal-content"},j={class:"modal-header bg-dark text-white"},O=Object(o["h"])("h5",{class:"modal-title"},"優惠券建立",-1),f={class:"modal-body"},g={class:"formGroup mb-3"},v=Object(o["h"])("label",{for:"title",class:"form-label"},"優惠券名稱",-1),C={class:"formGroup mb-3"},D=Object(o["h"])("label",{for:"percent",class:"form-label"},"優惠券折扣數",-1),y={class:"formGroup mb-3"},M=Object(o["h"])("label",{for:"code",class:"form-label"},"優惠代碼",-1),k={class:"formGroup mb-3"},_=Object(o["h"])("label",{for:"due_date",class:"form-label"},"到期日",-1),w={key:0,class:"formGroup mb-3"},x=Object(o["h"])("label",{for:"is_enabled"},"是否啟用",-1),$={class:"modal-footer"},V={key:0,type:"submit",class:"btn btn-primary"},G={key:1,type:"submit",class:"btn btn-primary"};function F(t,e,a,n,c,l){var d=Object(o["y"])("Field"),i=Object(o["y"])("ErrorMessage"),s=Object(o["y"])("Form");return Object(o["t"])(),Object(o["d"])("div",p,[Object(o["h"])("div",h,[Object(o["h"])("div",m,[Object(o["h"])(s,{onSubmit:e[8]||(e[8]=function(t){return l.postCoupon(c.modal)}),key:c.clearForm},{default:Object(o["J"])((function(t){var a=t.errors;return[Object(o["h"])("div",j,[O,Object(o["h"])("button",{type:"button",class:"btn-close btn-close-white",onClick:e[1]||(e[1]=function(){return l.closeModal&&l.closeModal.apply(l,arguments)})})]),Object(o["h"])("div",f,[Object(o["h"])("div",g,[v,Object(o["h"])(d,{type:"text",class:["form-control",{"is-invalid":a["優惠券名稱"]}],id:"title",name:"優惠券名稱",placeholder:"請輸入優惠券名稱",rules:"required",modelValue:c.tempData.title,"onUpdate:modelValue":e[2]||(e[2]=function(t){return c.tempData.title=t})},null,8,["class","modelValue"]),Object(o["h"])(i,{name:"優惠券名稱",class:"invalid-feedback"})]),Object(o["h"])("div",C,[D,Object(o["h"])(d,{type:"number",class:["form-control",{"is-invalid":a["優惠券折扣數"]}],id:"percent",name:"優惠券折扣數",placeholder:"請輸入優惠券折扣數(單位為%)",rules:l.percentRule,min:"0",modelValue:c.tempData.percent,"onUpdate:modelValue":e[3]||(e[3]=function(t){return c.tempData.percent=t}),modelModifiers:{number:!0}},null,8,["class","rules","modelValue"]),Object(o["h"])(i,{name:"優惠券折扣數",class:"invalid-feedback"})]),Object(o["h"])("div",y,[M,Object(o["h"])(d,{type:"text",class:["form-control",{"is-invalid":a["優惠代碼"]}],id:"code",name:"優惠代碼",placeholder:"請輸入優惠代碼",rules:"required",modelValue:c.tempData.code,"onUpdate:modelValue":e[4]||(e[4]=function(t){return c.tempData.code=t})},null,8,["class","modelValue"]),Object(o["h"])(i,{name:"優惠代碼",class:"invalid-feedback"})]),Object(o["h"])("div",k,[_,Object(o["h"])(d,{type:"date",class:["form-control",{"is-invalid":a["到期日"]}],id:"due_date",name:"到期日",placeholder:"請輸入到期日",rules:"required",modelValue:c.tempData.due_date_string,"onUpdate:modelValue":e[5]||(e[5]=function(t){return c.tempData.due_date_string=t})},null,8,["class","modelValue"]),Object(o["h"])(i,{name:"到期日",class:"invalid-feedback"})]),"addCoupon"===c.modal?(Object(o["t"])(),Object(o["d"])("div",w,[Object(o["h"])("input",{type:"checkbox",id:"is_enabled",name:"is_enabled",onChange:e[6]||(e[6]=function(){return l.isEnabled&&l.isEnabled.apply(l,arguments)})},null,32),x])):Object(o["e"])("",!0)]),Object(o["h"])("div",$,[Object(o["h"])("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal",onClick:e[7]||(e[7]=function(){return l.closeModal&&l.closeModal.apply(l,arguments)})},"取消"),"addCoupon"===c.modal?(Object(o["t"])(),Object(o["d"])("button",V,"建立")):(Object(o["t"])(),Object(o["d"])("button",G,"編輯"))])]})),_:1})])])],512)}var B=a("7b17"),E=a("1940"),L=a.n(E),U={data:function(){return{couponModal:{},modal:"",tempData:{title:"",percent:"",due_date_string:"",code:"",is_enabled:0},clearForm:!1}},emits:["getCouponsData"],methods:{openModal:function(){this.clearForm=!1,this.couponModal.show()},closeModal:function(){this.clearForm=!0,this.clearData(),this.modal="",this.couponModal.hide()},clearData:function(){this.tempData={title:"",percent:"",due_date_string:"",code:"",is_enabled:0}},percentRule:function(t){return t?t>=100?"優惠券折扣數 必須小於100":!(t<=0)||"優惠券折扣數 不得小於等於0":"優惠券折扣數 為必填欄位"},isEnabled:function(){this.tempData.is_enabled?this.tempData.is_enabled=0:this.tempData.is_enabled=1},postCoupon:function(t){var e=this,a={};if(a.data=Object(b["a"])({},this.tempData),a.data.due_date=Date.parse(this.tempData.due_date_string)/1e3,"addCoupon"===t){var o="".concat("https://vue3-course-api.hexschool.io/","api/").concat("jun0527","/admin/coupon");this.$http.post(o,a).then((function(t){t.data.success?(e.$emit("getCouponsData"),L()("優惠券建立成功！"),e.closeModal()):(L()("優惠券建立失敗！"),e.closeModal())})).catch((function(){L()("網頁發生錯誤，請重新整理此頁面！")}))}else if("editCoupon"===t){var n="".concat("https://vue3-course-api.hexschool.io/","api/").concat("jun0527","/admin/coupon/").concat(this.tempData.id);this.$http.put(n,a).then((function(t){t.data.success?(e.$emit("getCouponsData"),L()("優惠券修改成功！"),e.closeModal()):(L()("優惠券修改失敗！"),e.closeModal())})).catch((function(){L()("網頁發生錯誤，請重新整理此頁面！")}))}}},mounted:function(){this.couponModal=new B["c"](this.$refs.modal,{backdrop:"static",keyboard:!1})}};U.render=F;var q=U,J=a("ec05"),S=a("1799"),R={data:function(){return{coupons:[],pagination:{},getCouponLoading:!0}},components:{CouponModal:q,DeleteModal:J["a"],pagination:S["a"]},methods:{getCouponData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;document.documentElement.scrollTop=0,this.getCouponLoading=!0;var a="".concat("https://vue3-course-api.hexschool.io/","api/").concat("jun0527","/admin/coupons?page=").concat(e);this.$http.get(a).then((function(e){e.data.success?(t.coupons=e.data.coupons,t.pagination=e.data.pagination,t.getCouponLoading=!1):L()("優惠券資料讀取失敗！")})).catch((function(){L()("網頁發生錯誤，請重新整理此頁面！")}))},openModal:function(t,e){"addCoupon"===t?(this.$refs.couponModal.openModal(),this.$refs.couponModal.modal=t):"editCoupon"===t?(this.$refs.couponModal.openModal(),this.$refs.couponModal.modal=t,this.$refs.couponModal.tempData=Object(b["a"])({},e)):"deleteCoupon"===t&&(this.$refs.deleteModal.openModal(),this.$refs.deleteModal.deleteCouponData=Object(b["a"])({},e))},changeStatus:function(t,e){var a=this,o={};o.data=Object(b["a"])({},e),o.data.is_enabled=t?0:1;var n="".concat("https://vue3-course-api.hexschool.io/","api/").concat("jun0527","/admin/coupon/").concat(e.id);this.$http.put(n,o).then((function(t){t.data.success?(a.getCouponData(a.pagination.current_page),L()("優惠券啟用狀態更改為".concat(o.data.is_enabled?"啟用":"不啟用","！"))):L()("優惠券啟用狀態更改失敗！")})).catch((function(){a.$swal({title:"網頁發生錯誤，請重新整理此頁面！",showConfirmButton:!1,icon:"error",timer:2e3})}))}},created:function(){this.getCouponData()}};R.render=r;e["default"]=R}}]);
//# sourceMappingURL=chunk-2d20fccc.685298ab.js.map